{% extends "base.html" %}
{% load static %}

{% block title %}Emergency Contacts{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="card shadow-sm p-4" style="background: rgba(255,255,255,0.98); border-radius: 14px;">
    <h2 class="mb-4 text-center" style="color: #dc3545;">
      ğŸš¨ Emergency & Quick Access
    </h2>
    
    <div class="alert alert-warning mb-4">
      <strong>âš ï¸ In case of life-threatening emergency, call 911 first!</strong>
    </div>

    {% if user.is_staff %}
    <a href="{% url 'add-emergency' %}" class="btn btn-primary mb-4">â• Add Emergency Contact</a>
    {% endif %}

    <!-- High Priority Contacts -->
    {% if high_priority_contacts %}
    <h3 class="mb-3" style="color: #dc3545;">ğŸ”´ Urgent Contacts</h3>
    <div class="row mb-4">
      {% for contact in high_priority_contacts %}
      <div class="col-md-6 mb-3">
        <div class="card border-danger shadow-sm h-100">
          <div class="card-header bg-danger text-white">
            <h5 class="mb-0">{{ contact.name }}</h5>
          </div>
          <div class="card-body">
            <p class="mb-2">
              <strong>ğŸ“ Phone:</strong> 
              <a href="tel:{{ contact.phone_number }}" class="text-decoration-none fs-5">
                {{ contact.phone_number }}
              </a>
            </p>
            <p class="mb-2"><strong>Department:</strong> {{ contact.department|default:"N/A" }}</p>
            <p class="text-muted mb-3">{{ contact.description }}</p>
            {% if contact.website %}
            <a href="{{ contact.website }}" target="_blank" class="btn btn-outline-danger btn-sm mb-2">
              ğŸŒ Visit Website
            </a>
            {% endif %}
            {% if user.is_staff %}
            <div class="mt-2">
              <a href="{% url 'edit-emergency' contact.pk %}" class="btn btn-primary btn-sm">Edit</a>
              <a href="{% url 'delete-emergency' contact.pk %}" class="btn btn-danger btn-sm">Delete</a>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Medium Priority Contacts -->
    {% if medium_priority_contacts %}
    <h3 class="mb-3" style="color: #ff9933;">ğŸŸ¡ Important Contacts</h3>
    <div class="row mb-4">
      {% for contact in medium_priority_contacts %}
      <div class="col-md-6 mb-3">
        <div class="card border-warning shadow-sm h-100">
          <div class="card-header bg-warning">
            <h5 class="mb-0">{{ contact.name }}</h5>
          </div>
          <div class="card-body">
            <p class="mb-2">
              <strong>ğŸ“ Phone:</strong> 
              <a href="tel:{{ contact.phone_number }}" class="text-decoration-none fs-5">
                {{ contact.phone_number }}
              </a>
            </p>
            <p class="mb-2"><strong>Department:</strong> {{ contact.department|default:"N/A" }}</p>
            <p class="text-muted mb-3">{{ contact.description }}</p>
            {% if contact.website %}
            <a href="{{ contact.website }}" target="_blank" class="btn btn-outline-warning btn-sm mb-2">
              ğŸŒ Visit Website
            </a>
            {% endif %}
            {% if user.is_staff %}
            <div class="mt-2">
              <a href="{% url 'edit-emergency' contact.pk %}" class="btn btn-primary btn-sm">Edit</a>
              <a href="{% url 'delete-emergency' contact.pk %}" class="btn btn-danger btn-sm">Delete</a>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Low Priority Contacts -->
    {% if low_priority_contacts %}
    <h3 class="mb-3" style="color: #667eea;">ğŸ”µ General Contacts</h3>
    <div class="row mb-4">
      {% for contact in low_priority_contacts %}
      <div class="col-md-6 mb-3">
        <div class="card border-primary shadow-sm h-100">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">{{ contact.name }}</h5>
          </div>
          <div class="card-body">
            <p class="mb-2">
              <strong>ğŸ“ Phone:</strong> 
              <a href="tel:{{ contact.phone_number }}" class="text-decoration-none fs-5">
                {{ contact.phone_number }}
              </a>
            </p>
            <p class="mb-2"><strong>Department:</strong> {{ contact.department|default:"N/A" }}</p>
            <p class="text-muted mb-3">{{ contact.description }}</p>
            {% if contact.website %}
            <a href="{{ contact.website }}" target="_blank" class="btn btn-outline-primary btn-sm mb-2">
              ğŸŒ Visit Website
            </a>
            {% endif %}
            {% if user.is_staff %}
            <div class="mt-2">
              <a href="{% url 'edit-emergency' contact.pk %}" class="btn btn-primary btn-sm">Edit</a>
              <a href="{% url 'delete-emergency' contact.pk %}" class="btn btn-danger btn-sm">Delete</a>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    {% if not high_priority_contacts and not medium_priority_contacts and not low_priority_contacts %}
    <div class="alert alert-info">
      <p class="mb-0">No emergency contacts available at this time.</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}